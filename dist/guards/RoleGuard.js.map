{"version":3,"sources":["../../src/guards/RoleGuard.ts"],"sourcesContent":["import { PermissionHandler } from \"@discordx/utilities\";\nimport { CommandInteraction, Guild, GuildMember, Role } from \"discord.js\";\nimport { Client, GuardFunction, Next, SimpleCommandMessage } from \"discordx\";\n\nexport function RoleGuard(\n    roleID: string\n): GuardFunction<PermissionHandler> {\n\n    async function handleReply(interaction: CommandInteraction, reply: string) {\n        if (interaction.replied)\n            await interaction.followUp(reply);\n        else if (interaction.deferred)\n            await interaction.editReply(reply);\n        else\n            await interaction.reply(reply);\n    }\n\n    async function noPerms(arg: PermissionHandler) {\n        if(arg instanceof SimpleCommandMessage)\n            await arg.message.reply(\"You don't have permission to execute this command.\");\n        else\n            await handleReply(arg, \"You don't have permission to execute this command.\");\n    }\n\n    return async function (arg: PermissionHandler, client: Client, next: Next) {\n        let guild: Guild | null = null;\n        let member: GuildMember | null = null;\n\n        if (arg instanceof SimpleCommandMessage) {\n            if(arg.message.inGuild()) {\n                guild = arg.message.guild;\n                member = arg.message.member;\n            }\n        } else {\n            guild = arg.guild;\n            if(arg.member instanceof GuildMember)\n                member = arg.member;\n        }\n\n        if(!guild || !member) {\n            if(arg instanceof SimpleCommandMessage)\n                await arg.message.reply(\"Error\");\n            else\n                handleReply(arg, \"Error\");\n        }\n\n        const isAllowed = member?.roles.cache.has(roleID);\n        if(isAllowed)\n            return next();\n        else\n            return noPerms(arg);\n    }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,qBAA6D;AAC7D,sBAAkE;AAE3D,SAAS,UACZ,QACgC;AAEhC,iBAAe,YAAY,aAAiC,OAAe;AACvE,QAAI,YAAY;AACZ,YAAM,YAAY,SAAS,KAAK;AAAA,aAC3B,YAAY;AACjB,YAAM,YAAY,UAAU,KAAK;AAAA;AAEjC,YAAM,YAAY,MAAM,KAAK;AAAA,EACrC;AAPe;AASf,iBAAe,QAAQ,KAAwB;AAC3C,QAAG,eAAe;AACd,YAAM,IAAI,QAAQ,MAAM,oDAAoD;AAAA;AAE5E,YAAM,YAAY,KAAK,oDAAoD;AAAA,EACnF;AALe;AAOf,SAAO,eAAgB,KAAwB,QAAgB,MAAY;AACvE,QAAI,QAAsB;AAC1B,QAAI,SAA6B;AAEjC,QAAI,eAAe,sCAAsB;AACrC,UAAG,IAAI,QAAQ,QAAQ,GAAG;AACtB,gBAAQ,IAAI,QAAQ;AACpB,iBAAS,IAAI,QAAQ;AAAA,MACzB;AAAA,IACJ,OAAO;AACH,cAAQ,IAAI;AACZ,UAAG,IAAI,kBAAkB;AACrB,iBAAS,IAAI;AAAA,IACrB;AAEA,QAAG,CAAC,SAAS,CAAC,QAAQ;AAClB,UAAG,eAAe;AACd,cAAM,IAAI,QAAQ,MAAM,OAAO;AAAA;AAE/B,oBAAY,KAAK,OAAO;AAAA,IAChC;AAEA,UAAM,YAAY,QAAQ,MAAM,MAAM,IAAI,MAAM;AAChD,QAAG;AACC,aAAO,KAAK;AAAA;AAEZ,aAAO,QAAQ,GAAG;AAAA,EAC1B;AACJ;AAhDgB;","names":[]}